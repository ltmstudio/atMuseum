<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>At Muzey - Kitaplar</title>

  <link rel="stylesheet" href="../css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Lovers+Quarrel" rel="stylesheet">

  <style>
    /* слой с видео */
    .video-container{position:relative}
    .video-container video{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover; z-index:0; pointer-events:none;
    }
    .navigation-container-btn{position:relative; z-index:20}
    .content{
      position:fixed; top:0; left:0; right:0; bottom:0;
      display:flex; align-items:center; justify-content:center; z-index:3;
    }
    .info-column,.info-content,#info-content{
      width:100%; height:100%; display:flex; align-items:center; justify-content:center;
    }

    /* ====== PURE JS BOOK EFFECT (адаптировано) ====== */
    .book{ transition: opacity .4s .2s; perspective: 250vw; }
    .pages{
      width: 64vw; 
      height: 44vw; 
      /* max-height: 1350px; max-width: 1900px; */
      position: relative;
      transform-style: preserve-3d;
      backface-visibility: hidden;
      border-radius: 6px;
    }
    .page{
      position:absolute; top:0;
      width:32vw; 
      height:44vw; 
      /* max-width:950px;max-height:1350px; */
      transform-origin: 0 0;
      transition: transform 1.2s;
      backface-visibility: hidden;
      transform-style: preserve-3d;
      cursor:pointer; user-select:none;
      background:#f0f0f0 center/contain no-repeat;
      /* box-shadow: 0 10px 35px rgba(0,0,0,.35); */
      /* ключевое: auto 100% */}
    .page:before{
      content:""; position:absolute; inset:0; z-index:2;
      background: rgba(0,0,0,0); transition: background .7s;
    }

    /* правая (odd) */
    .page:nth-child(odd){
      right:0; border-radius:0 6px 6px 0;
      background-image: linear-gradient(to right, rgba(0,0,0,.15) 0%, rgba(0,0,0,0) 10%);
      transform: rotateY(0deg);
      pointer-events: all;
    }
    .page:nth-child(odd):hover{ transform: rotateY(-15deg); }
    .page:nth-child(odd):hover:before{ background: rgba(0,0,0,.03); }

    /* левая (even) */
    .page:nth-child(even){
      left:0; border-radius:6px 0 0 6px;
      background-image: linear-gradient(to left, rgba(0,0,0,.12) 0%, rgba(0,0,0,0) 10%);
      transform-origin: 100% 0;
      transform: rotateY(180deg);
      pointer-events: none;
    }
    .page:nth-child(even):before{ background: rgba(0,0,0,.20); }

    /* flipped state */
    .page.flipped:nth-child(odd){
      transform: rotateY(-180deg); pointer-events:none;
    }
    .page.flipped:nth-child(odd):before{ background: rgba(0,0,0,.20); }
    .page.flipped:nth-child(even){
      transform: rotateY(0deg); pointer-events:all;
    }
    .page.flipped:nth-child(even):hover{ transform: rotateY(15deg); }
    .page.flipped:nth-child(even):hover:before{ background: rgba(0,0,0,.03); }
    .page.flipped:nth-child(even):before{ background: rgba(0,0,0,0); }

  
    /* .page p{
      margin-top: 8vw; text-align:center; font-size: 5vw; color:#000;
      font-family: 'Lovers Quarrel', cursive;
    } */

    .info-message{
      color:#ff5555; background:rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.25); padding:10px 12px; border-radius:8px; font-weight:600;
    }
    


    .page.align-center-bottom {
     background-size: auto 100% !important;
     background-position: center bottom !important;
    }


  </style>
</head>
<body>
  <div class="video-container">
    <video id="mainVideo" autoplay muted loop playsinline>
      <source src="../assets/videos/kitaplar/kitaplar_fon.mp4" type="video/mp4">
      Ваш браузер не поддерживает видео.
    </video>
    <a href="javascript:history.back()" class="back-btn-bedewler" aria-label="Назад">
      YZA
  </a>
    <div class="navigation-container-btn">
      <div class="container-fluid">
        <!-- <a href="javascript:history.back()" class="back-btn" aria-label="Назад">
          <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
        </a> -->
        
      </div>
    </div>

    <div class="container-fluid content">
      <div class="info-column">
        <div class="info-content">
          <div id="info-content"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/main.js"></script>

  <script>
    (function () {
    const params = new URLSearchParams(location.search);
    const key = params.get('key') || 'book1';

    const mount = document.getElementById('info-content');

    // карты книг: папка, префикс, кол-во
    const sets = {
      book1: {
        title: 'Atda Wepa-da bar, Sapada',
        dir: '../pdf/ATDA WEPA-DA BAR, SAPA-DA/1.ATDA WEPA-DA BAR, SAPA-DA/',
        prefix: '1.ATDA WEPA-DA BAR, SAPA-DA - ',
        count: 358, pad: 4,
        customSequence: false
      },
      book2: {
        title: 'Ganatly Bedew',
        dir: '../pdf/Ganatly bedew/(wnut) Sonky wariant 18.04 - TM/',
        prefix: '(wnut) Sonky wariant 18.04 - TM - ',
        count: 288, pad: 4
      },
      book3: { title: 'Bedew Galkynyşyň Ganaty', dir: '../pdf/Book3/', prefix: 'page-', count: 0, pad: 4 },
      book4: { title: 'Ahalteke Bedewi...', dir: '../pdf/Book4/', prefix: 'page-', count: 0, pad: 4 }
    };

    const conf = sets[key];
    if (!conf || !conf.count) {
      mount.innerHTML = '<div class="info-message">Нет страниц. Укажи ?key=book1|book2 и заполни count.</div>';
      return;
    }

    const pad = (n,l)=> String(n).padStart(l,'0');
    function seq(){
      if (conf.customSequence) {
        const s=[1,4,2,3,4]; for(let i=5;i<=conf.count;i++) s.push(i); return s;
      }
      return Array.from({length: conf.count}, (_,i)=> i+1);
    }
    const order = seq();
    const pathOf = (n)=> encodeURI(conf.dir + conf.prefix + pad(n, conf.pad) + '.jpg');

    // строим книгу
    const bookEl = document.createElement('div');
    bookEl.className = 'book';
    const pagesEl = document.createElement('div');
    pagesEl.className = 'pages';
    bookEl.appendChild(pagesEl);

    // первая страница с текстом (можно убрать)
    // const first = document.createElement('div');
    // first.className = 'page';
    // first.innerHTML = '<p>Open Me,<br>please!</p>';
    // pagesEl.appendChild(first);

    // создаём страницы под все изображения
    order.forEach(n=>{
      const p = document.createElement('div');
      p.className = 'page';
      p.style.backgroundImage = `url("${pathOf(n)}")`;
      pagesEl.appendChild(p);
    });

    mount.innerHTML = '';
    mount.appendChild(bookEl);

    // z-index для слоя страниц
    const pages = pagesEl.getElementsByClassName('page');
    for (let i=0;i<pages.length;i++){
      if (i % 2 === 0) pages[i].style.zIndex = (pages.length - i);
    }

    // логика клика (перелистывание пары)
    for (let i=0;i<pages.length;i++){
      pages[i].pageNum = i + 1;
      pages[i].onclick = function(){
        if (this.pageNum % 2 === 0){
          this.classList.remove('flipped');
          this.previousElementSibling && this.previousElementSibling.classList.remove('flipped');
        } else {
          this.classList.add('flipped');
          this.nextElementSibling && this.nextElementSibling.classList.add('flipped');
        }
      };
    }

    // навигация стрелками
    document.addEventListener('keydown', function(e){
      if (e.key === 'ArrowRight') {
        // ищем первую не перевёрнутую правую страницу
        for (let i=0;i<pages.length;i++){
          if (pages[i].pageNum % 2 === 1 && !pages[i].classList.contains('flipped')){
            pages[i].click(); break;
          }
        }
      } else if (e.key === 'ArrowLeft') {
        // ищем ближайшую перевёрнутую левую и откатываем
        for (let i=pages.length-1;i>=0;i--){
          if (pages[i].pageNum % 2 === 0 && pages[i].classList.contains('flipped')){
            pages[i].click(); break;
          }
        }
      }
    });
    })();



    (function alignSpecific(){
    const fix = new Set(['0140','0141']); // номера проблемных JPG
    document.querySelectorAll('.page').forEach(p=>{
    const raw = p.style.backgroundImage;
    if (!raw) return;
    const url = raw.replace(/^url\(["']?/, '').replace(/["']?\)$/, '');
    const name = decodeURIComponent(url.split('/').pop());  // ...0140.jpg
    const m = name.match(/(\d+)\.jpg$/i);
    if (m && fix.has(m[1])) {
      p.classList.add('align-center-bottom');
    }
    });
    })();

  </script>
</body>
</html>
